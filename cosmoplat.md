# 卡奥斯平台

卡奥斯平台采用HTTP协议获取鉴权,底层使用MQTT协议进行通讯,网关采取对用户透明的方是配置,简化配置操作



## 参数

* 推送周期: 此参数并非数据实际上传频率,为最小上传频率,如果采集周期过大,推送周期以实际采集数据为准
* BaseUrl: 平台鉴权地址,默认为http://edge.cosmoplat.com:8200
* CompanyID: 连接MQ的客户端标识。由客户来为每个客户端分配，并保证唯一性；引用业务相关项目名称、厂站名称、机房名称、设备名称等，由接入方自行组合确定.
* DeviceType: 设备的类型。由客户自由定义
* SecretKey: IoT平台颁发的设备证书，此处为证书内容，不包括首行（BEGIN）整行、末行（END）整行。


## 主题

推送主题: ${company_id}/${assetName}/update

其中

* ${company_id} 为参数里的CompanyID
* ${assetName} 为设备名,为采集配置界面的设备编号

## 数据格式

每一条数据为一个设备一个采集周期内的所有数据,如果status为false,则metrics为空对象

```json
{
  "profileVersion" : 1,             //固定值
  "reported" : {
    "sn" : "GEA5FF34D48366E64",     //网关唯一ID,为授权界面的设备指纹
    "gatewayModel" : "G612",        //网关型号,网关信息界面的硬件版本
    "status" : true,                //子设备连接状态,已连接为true,未连接为false
    "assetName" : "Asset-test",     //子设备名,为采集配置界面的设备编号
    "metrics" : {                   //采集到的设备数据
      "Channel-1" : 3567,           //变量名：变量值,变量名参考点位地址列表
      "Channel-2" : 50,
      "Channel-3" : 100
    }
  },
  "deviceId" : "xxxxxxxxxx",        //由http接口鉴权分配
  "version" : 1,                    //固定值
  "timestamp" : 1590030573793       //当前采集数据的Unix时间戳,单位为秒
}
```

## 自动重连

网关在断网后会自动常识重连服务器,直至重新连接成功

断网期间的数据会保存到缓存用于断点续传

## 断点续传

当网关推送数据失败后,网关会将数据暂存.待下次有数据推送成功之后,网关会分配将缓存数据再次上传

存储规则如下

* 未插入SD卡: 存储至网关内置空间剩余10%,大约为100MB
* 插入SD卡: 存储至SD卡空间剩余10%,具体容量取决于SD卡大小
* 存储空间达到阈值后不再存储新数据,直至缓存数据推送完毕